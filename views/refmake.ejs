<html lang="en"><head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>c4ei.net</title>
	<link rel="stylesheet" href="/css/main.css">
	<script src="/js/jquery.min.js"></script>
</head>

<body data-theme="light">
<main class="">
<div style="padding-top:50px;"></div>
<div style="text-align:center;max-width:800px;margin: auto;">
	<div id="popup-parent">
		<div class="popup-container">

<!-- ########################################################################### -->   
<div id="ly_netErr" style="display:block;" class="popup">
    
    <h4 id="ly_dispmsg" style="color: rgb(107, 101, 93);font-size: 12px;margin-top: 15px;">메타마스크 연동 후 추천인 코드생성이 가능 합니다.</h4>

    <button class="enableEthereumButton" style="background-color: #ff9900;">1. Connect Metamask</button>
    <!-- <span class="showAccount" style="font-size: 8px;"></span><br/> -->
    <input type="button" value="추천인 코드생성" id="btn_save_ref" onclick='jsfn_ref_make();' style="cursor: pointer;visibility: hidden;width:160px;height:30px;background-color: cornflowerblue;margin-top: 15px;" >

    <div id="htmlForm" style="display: block;">
    <!-- <form id="sendForm" name="sendForm" method="post" action="/ref_ok"> -->
        내지갑주소:<input type="text"  id="txt_my_address" name="txt_my_address" value=""  style="margin-top: 5px;">
        <textarea id="txt_link" style="width:400px;margin-top: 5px;" rows="5"></textarea>
    <!-- </form> -->
</div>

<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
<script>
    //------------ 2022-03-30
    const btnMetaMask = document.querySelector('.enableEthereumButton');
    // const showAccount = document.querySelector('.showAccount');
    btnMetaMask.addEventListener('click', () => { jsfn_getAccount(); });

    async function jsfn_getAccount() {
        if (typeof window.ethereum === 'undefined') {
            alert('MetaMask is not installed!');
            return;
        }
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        const account = accounts[0];
        // showAccount.innerHTML = "address:"+account;
        btnMetaMask.style.display='none';
        jsfn_bindAddress(account);
    }

    function jsfn_bindAddress(addr){
        if (addr!==undefined){
            jsfn_btnShowHide('visible');
            jsfn_chkAddress(addr);
        } else {
            jsfn_btnShowHide('hidden');
        }
    }
    function jsfn_btnShowHide(str){
        let _msg = document.getElementById('ly_dispmsg');
        if(str == 'visible'){ _msg.style.display = 'none'; } else { _msg.style.display = 'block'; }
    }
    function jsfn_chkAddress(addr){
        document.getElementById('txt_my_address').value = addr;
        document.getElementById('btn_save_ref').style.visibility = 'visible';
    }
    function jsfn_ref_make(){
        let chkAddr = document.getElementById('txt_my_address').value;
        let txt_link = document.getElementById('txt_link');
        txt_link.value = 'https://c4ei.net/ref/'+chkAddr;
        txt_link.select();
        document.execCommand('copy');
        alert('복사되었습니다.');
    }
</script>
<!-- ########################################################################### -->   
			<br/>
			<br/>
			<a href="/"> click ! go main again  </a> 
			</div>
		</div>
	</div>
</div>
</main>

</body>
</html>
